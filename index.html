<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æŠ¥ä»·æ–¹æ¡ˆç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap");

      body {
        font-family: "Noto Sans SC", sans-serif;
      }

      .page {
        width: 210mm;
        min-width: 210mm;
        max-width: 210mm;
        height: auto;
        max-height: none;
        margin: 0 auto;
        background: white;
        padding: 20px 25px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        box-sizing: border-box;
        position: absolute;
        cursor: move;
        user-select: none;
      }

      .page:active {
        cursor: grabbing;
      }

      .preview-container {
        position: relative;
        width: 100%;
        height: 100%;
        min-height: 100%;
      }

      @media print {
        .page {
          box-shadow: none;
          margin: 0;
        }
      }

      .scrollbar-thin::-webkit-scrollbar {
        width: 6px;
      }

      .scrollbar-thin::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      .scrollbar-thin::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 3px;
      }

      .scrollbar-thin::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
    </style>
  </head>
  <body>
    <div id="app" class="flex h-screen bg-gray-50">
      <!-- å·¦ä¾§é¢„è§ˆåŒº -->
      <div class="scrollbar-thin flex-1 overflow-auto p-8">
        <div class="preview-container" @wheel="handleWheel">
          <div
            class="page"
            id="pdf-content"
            @mousedown="startDrag"
            :style="{
              left: pageX + 'px',
              top: pageY + 'px',
              transform: 'scale(' + scale + ')',
              transformOrigin: 'top left',
              cursor: isDragging ? 'grabbing' : 'move'
            }"
          >
            <!-- æ ‡é¢˜ -->
            <div class="mb-3 text-center">
              <h1 class="mb-2 text-xl font-bold">
                {{ projectName || 'é¡¹ç›®åç§°' }}è®¾è®¡éœ€æ±‚æŠ¥ä»·æ–¹æ¡ˆ
              </h1>
              <div class="mb-2 flex justify-between text-xs text-gray-600">
                <div>
                  æŠ¥ä»·æ—¶é—´ï¼š<span class="font-medium"
                    >{{ quoteDate || '2025å¹´6æœˆ6æ—¥' }}</span
                  >
                  <span class="text-gray-400"
                    >ï¼ˆæœ‰æ•ˆæœŸè‡³ {{ validUntil || '2025å¹´7æœˆ6æ—¥' }}ï¼‰</span
                  >
                </div>
                <div>
                  å®¢æˆ·ï¼š<span class="font-medium"
                    >{{ clientName || 'å®¢æˆ·åç§°' }}</span
                  >
                </div>
              </div>
            </div>

            <!-- ä¸»è¡¨æ ¼ -->
            <div class="mb-3 border-2 border-gray-800">
              <!-- è¡¨å¤´ -->
              <div class="grid grid-cols-12 border-b-2 border-gray-800">
                <div class="col-span-2 border-r border-gray-800 p-2 font-bold">
                  å·¥ä½œé¡¹
                </div>
                <div
                  class="col-span-1 border-r border-gray-800 p-2 text-center font-bold"
                >
                  é‡‘é¢
                </div>
                <div
                  class="col-span-1 border-r border-gray-800 p-2 text-center font-bold"
                >
                  åŸä»·
                </div>
                <div
                  class="col-span-1 border-r border-gray-800 p-2 text-center font-bold"
                >
                  å•ä½
                </div>
                <div class="col-span-3 border-r border-gray-800 p-2 font-bold">
                  å¤‡æ³¨
                </div>
                <div class="col-span-4 p-2 font-bold">æç¤º</div>
              </div>

              <!-- UI ç±»è®¾è®¡æ ‡é¢˜ -->
              <div
                class="border-b border-gray-800 bg-gray-50 p-1.5 text-sm font-bold"
              >
                UI ç±»è®¾è®¡
              </div>

              <!-- åŠ¨æ€è¡¨æ ¼è¡Œ -->
              <div
                v-for="(row, index) in tableRows"
                :key="index"
                class="grid grid-cols-12 border-b border-gray-800"
              >
                <div class="col-span-2 border-r border-gray-800 p-1.5 text-sm">
                  {{ row.workItem }}
                </div>
                <div
                  class="col-span-1 border-r border-gray-800 p-1.5 text-center text-sm font-bold"
                >
                  {{ row.amount }}
                </div>
                <div
                  class="col-span-1 border-r border-gray-800 p-1.5 text-center text-sm text-gray-400 line-through"
                >
                  {{ row.originalPrice }}
                </div>
                <div
                  class="col-span-1 border-r border-gray-800 p-1.5 text-center text-xs"
                >
                  {{ row.unit }}
                </div>
                <div class="col-span-3 border-r border-gray-800 p-1.5 text-sm">
                  {{ row.remarks }}
                </div>
                <div
                  class="col-span-4 p-1.5 text-xs leading-relaxed"
                  v-html="row.tips"
                ></div>
              </div>

              <!-- ç©ºè¡Œ -->
              <div class="border-b-2 border-gray-800 p-3"></div>

              <!-- æŠ¥ä»·æ±‡æ€» -->
              <div class="grid grid-cols-12">
                <div
                  class="col-span-2 border-r border-gray-800 p-1.5 text-sm font-bold"
                >
                  æŠ¥ä»·æ±‡æ€»
                </div>
                <div
                  class="col-span-2 border-r border-gray-800 p-1.5 text-center"
                >
                  <div class="text-base font-bold text-red-600">
                    $ {{ totalAmount }}
                  </div>
                  <div class="text-xs text-gray-400 line-through">
                    ({{ discountedTotal }})
                  </div>
                </div>
                <div
                  class="col-span-1 border-r border-gray-800 p-1.5 text-center text-sm text-gray-400 line-through"
                >
                  {{ totalOriginalPrice }}
                </div>
                <div
                  class="col-span-1 border-r border-gray-800 p-1.5 text-center text-xs"
                >
                  å…ƒ
                </div>
                <div class="col-span-6 p-1.5">
                  <span
                    class="inline-flex items-center rounded bg-orange-100 px-2 py-1 text-xs text-orange-600"
                  >
                    {{ summaryNote || 'æ–°å®¢ä¼˜æƒ ' }}
                  </span>
                </div>
              </div>
            </div>

            <!-- äº¤ä»˜æ ‡å‡† -->
            <div class="mb-2">
              <div class="mb-1 text-sm font-bold">äº¤ä»˜æ ‡å‡†ï¼š</div>
              <div class="space-y-0.5 pl-4 text-xs leading-relaxed">
                <div>
                  â‘  äº¤ä»˜ PPT å½¢å¼çš„ UI ç•Œé¢è®¾è®¡æ–¹æ¡ˆ 2
                  å¥—ï¼Œä»¥é¦–é¡µ+äºŒçº§é¡µé¢ä¸ºä¸»è¦æ•ˆæœå±•ç¤ºï¼ˆPPT æ ¼å¼ï¼‰
                </div>
                <div>
                  â‘¡ ç¡®è®¤é£æ ¼åæ ¹æ®é£æ ¼è®¾è®¡æ–¹æ¡ˆ PPT åˆ¶ä½œè®¾è®¡å›¾ï¼ˆäº¤ä»˜ PSD
                  æ ¼å¼ï¼Œå¹¶ä¸Šä¼ è“æ¹–-å¼€å‘è®¾è®¡åœ¨çº¿ååŒå·¥å…·ï¼‰ï¼Œå¹¶å®Œæˆåˆ‡å›¾å·¥ä½œåäº¤ä»˜ï¼ˆå¹¶ä¸”äº¤ä»˜æºæ–‡ä»¶ï¼‰
                </div>
              </div>
            </div>

            <!-- åˆä½œé¡»çŸ¥ -->
            <div class="mb-4">
              <div class="mb-1 text-sm font-bold">åˆä½œé¡»çŸ¥ï¼š</div>
              <div class="space-y-0.5 pl-4 text-xs leading-relaxed">
                <div>
                  â‘  éœ€é¢„ä»˜ 50%ä½œä¸ºå®šé‡‘å¯åŠ¨é¡¹ç›®ï¼ˆå³ {{ Math.round(totalAmount *
                  0.5) }}ï¼‰ï¼ŒPPT æ–¹æ¡ˆåä¸æ»¡æ„æ”¶å–æ•´ä½“é‡‘é¢çš„ 10%ä½œä¸ºæ–¹æ¡ˆè´¹ï¼›ï¼ˆå³
                  {{ Math.round(totalAmount * 0.1) }} å…ƒï¼‰
                </div>
                <div>â‘¡ å°ä¿®å°æ”¹èƒ½å¸®å–æœä¸€å®šä¼šå¸®å¿™ï¼Œè¯·æ”¾å¿ƒå¤§èƒ†æå‡ºå…è´¹çš„ï¼›</div>
              </div>
            </div>

            <!-- åº•éƒ¨å¤‡æ³¨ -->
            <div class="mb-3 space-y-0.5 text-xs text-gray-500">
              <div>1ã€ä»¥ä¸ŠæŠ¥ä»·æœ‰æ•ˆæœŸ 1 ä¸ªæœˆã€‚</div>
              <div>2ã€åˆä½œç¡®è®¤éœ€æ”¯ä»˜50%ä½œä¸ºå®šé‡‘å¯åŠ¨é¡¹ç›®ã€‚</div>
              <div>
                3ã€å¹³é¢è®¾è®¡ä¸ä½äº2å¥—çš„è®¾è®¡æ–¹æ¡ˆã€‚UIç•Œé¢åˆ™ä»¥é¦–é¡µä¸ä¸€äºŒçº§é¡µé¢è®¾è®¡ä¸ä½äº2å¥—ç•Œé¢æ–¹æ¡ˆã€‚
              </div>
              <div class="ml-4">å‡ä»¥PPTå½¢å¼å±•ç¤ºæ–¹æ¡ˆï¼›</div>
            </div>

            <!-- åº•éƒ¨ä¿¡æ¯ -->
            <div class="flex items-end justify-between">
              <div>
                <div class="mb-2 text-base font-bold">UIè®¾è®¡</div>
                <div class="text-xs text-gray-500 uppercase">UI DESIGN</div>
              </div>
              <div class="text-center">
                <div class="mb-2">
                  <img
                    v-if="qrCodeImage"
                    :src="qrCodeImage"
                    alt="QR Code"
                    class="h-20 w-20 object-cover"
                  />
                  <div
                    v-else
                    class="flex h-20 w-20 items-center justify-center border-2 border-dashed border-gray-400 bg-gray-100 text-xs text-gray-400"
                  >
                    äºŒç»´ç 
                  </div>
                </div>
                <div class="flex items-center justify-center gap-1">
                  <svg class="h-3 w-3" viewBox="0 0 24 24" fill="currentColor">
                    <path
                      d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                    />
                  </svg>
                  <span class="text-xs"
                    >{{ designerName || '@æŸæŸè®¾è®¡å¸ˆ' }}</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- å³ä¾§æ“ä½œåŒº -->
      <div
        class="scrollbar-thin w-96 overflow-auto border-l border-gray-200 bg-white p-6 shadow-lg"
      >
        <h2 class="mb-6 text-xl font-bold text-gray-800">æŠ¥ä»·æ–¹æ¡ˆç¼–è¾‘å™¨</h2>

        <!-- åŸºç¡€ä¿¡æ¯ -->
        <div class="mb-6 space-y-4 rounded-lg bg-gray-50 p-4">
          <h3 class="font-semibold text-gray-700">åŸºç¡€ä¿¡æ¯</h3>

          <div>
            <label class="mb-1 block text-sm font-medium text-gray-600"
              >é¡¹ç›®åç§°</label
            >
            <input
              v-model="projectName"
              type="text"
              placeholder="å¦‚ï¼šæŸæŸé¡¹ç›®"
              class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"
            />
          </div>

          <div>
            <label class="mb-1 block text-sm font-medium text-gray-600"
              >æŠ¥ä»·æ—¶é—´</label
            >
            <input
              v-model="quoteDate"
              type="text"
              placeholder="2025å¹´6æœˆ6æ—¥"
              class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"
            />
          </div>

          <div>
            <label class="mb-1 block text-sm font-medium text-gray-600"
              >æœ‰æ•ˆæœŸè‡³</label
            >
            <input
              v-model="validUntil"
              type="text"
              placeholder="2025å¹´7æœˆ6æ—¥"
              class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"
            />
          </div>

          <div>
            <label class="mb-1 block text-sm font-medium text-gray-600"
              >å®¢æˆ·åç§°</label
            >
            <input
              v-model="clientName"
              type="text"
              placeholder="æŸæŸå…¬å¸"
              class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"
            />
          </div>

          <div>
            <label class="mb-1 block text-sm font-medium text-gray-600"
              >è®¾è®¡å¸ˆåç§°</label
            >
            <input
              v-model="designerName"
              type="text"
              placeholder="@æŸæŸè®¾è®¡å¸ˆ"
              class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"
            />
          </div>

          <div>
            <label class="mb-1 block text-sm font-medium text-gray-600"
              >äºŒç»´ç å›¾ç‰‡</label
            >
            <div class="space-y-2">
              <input
                type="file"
                accept="image/*"
                @change="handleQRCodeUpload"
                class="w-full text-sm file:mr-4 file:rounded file:border-0 file:bg-blue-50 file:px-4 file:py-2 file:text-sm file:font-medium file:text-blue-700 hover:file:bg-blue-100"
              />
              <div v-if="qrCodeImage" class="flex items-center gap-2">
                <img
                  :src="qrCodeImage"
                  alt="é¢„è§ˆ"
                  class="h-16 w-16 rounded border border-gray-300 object-cover"
                />
                <button
                  @click="removeQRCode"
                  class="rounded bg-red-500 px-2 py-1 text-xs text-white hover:bg-red-600"
                >
                  åˆ é™¤
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- æ·»åŠ è¡¨æ ¼è¡Œ -->
        <div class="mb-6 space-y-4 rounded-lg bg-blue-50 p-4">
          <h3 class="font-semibold text-gray-700">æ·»åŠ å·¥ä½œé¡¹</h3>

          <div>
            <label class="mb-1 block text-sm font-medium text-gray-600"
              >å·¥ä½œé¡¹</label
            >
            <input
              v-model="newRow.workItem"
              type="text"
              placeholder="å¦‚ï¼šä¸€çº§é¡µé¢"
              class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"
            />
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="mb-1 block text-sm font-medium text-gray-600"
                >é‡‘é¢</label
              >
              <input
                v-model.number="newRow.amount"
                type="number"
                placeholder="1400"
                class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"
              />
            </div>

            <div>
              <label class="mb-1 block text-sm font-medium text-gray-600"
                >åŸä»·</label
              >
              <input
                v-model.number="newRow.originalPrice"
                type="number"
                placeholder="2000"
                class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"
              />
            </div>
          </div>

          <div>
            <label class="mb-1 block text-sm font-medium text-gray-600"
              >å•ä½</label
            >
            <input
              v-model="newRow.unit"
              type="text"
              placeholder="å…ƒ/é¡¹"
              class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"
            />
          </div>

          <div>
            <label class="mb-1 block text-sm font-medium text-gray-600"
              >å¤‡æ³¨</label
            >
            <input
              v-model="newRow.remarks"
              type="text"
              placeholder="é¦–é¡µ"
              class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"
            />
          </div>

          <div>
            <label class="mb-1 block text-sm font-medium text-gray-600"
              >æç¤º</label
            >
            <textarea
              v-model="newRow.tips"
              placeholder="æ•´ä½“å·¥æ—¶å®‰æ’ï¼š<br />â‘  3å¤©è®¾è®¡..."
              rows="3"
              class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"
            ></textarea>
          </div>

          <button
            @click="addRow"
            class="w-full rounded bg-blue-600 px-4 py-2 text-sm font-medium text-white transition hover:bg-blue-700"
          >
            â• æ·»åŠ åˆ°è¡¨æ ¼
          </button>
        </div>

        <!-- å·²æ·»åŠ çš„è¡Œåˆ—è¡¨ -->
        <div v-if="tableRows.length > 0" class="mb-6 space-y-2">
          <h3 class="font-semibold text-gray-700">
            å·²æ·»åŠ é¡¹ç›® ({{ tableRows.length }})
          </h3>
          <div
            v-for="(row, index) in tableRows"
            :key="index"
            class="flex items-center justify-between rounded bg-gray-50 p-3 text-sm"
          >
            <div class="flex-1">
              <div class="font-medium">{{ row.workItem }}</div>
              <div class="text-xs text-gray-500">
                Â¥{{ row.amount }} / {{ row.unit }}
              </div>
            </div>
            <button
              @click="removeRow(index)"
              class="ml-2 rounded bg-red-500 px-2 py-1 text-xs text-white hover:bg-red-600"
            >
              åˆ é™¤
            </button>
          </div>
        </div>

        <!-- æ±‡æ€»ä¿¡æ¯ -->
        <div class="mb-6 space-y-4 rounded-lg bg-green-50 p-4">
          <h3 class="font-semibold text-gray-700">æ±‡æ€»ä¿¡æ¯</h3>

          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600">æ€»é‡‘é¢ï¼š</span>
              <span class="font-bold text-green-600">Â¥{{ totalAmount }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">æ€»åŸä»·ï¼š</span>
              <span class="text-gray-400 line-through"
                >Â¥{{ totalOriginalPrice }}</span
              >
            </div>
          </div>

          <div>
            <label class="mb-1 block text-sm font-medium text-gray-600"
              >æŠ˜æ‰£æ¯”ä¾‹ (%)</label
            >
            <input
              v-model.number="discountRate"
              type="number"
              placeholder="91"
              min="0"
              max="100"
              class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"
            />
            <div class="mt-1 text-xs text-gray-500">
              æŠ˜åé‡‘é¢ï¼šÂ¥{{ discountedTotal }}
            </div>
          </div>

          <div>
            <label class="mb-1 block text-sm font-medium text-gray-600"
              >æ±‡æ€»æç¤º</label
            >
            <input
              v-model="summaryNote"
              type="text"
              placeholder="æ–°å®¢ä¼˜æƒ ï¼ˆæŠ¥ä»·é‡‘é¢ 91 æŠ˜ï¼‰"
              class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"
            />
          </div>
        </div>

        <!-- ç”ŸæˆPDFæŒ‰é’® -->
        <button
          @click="generatePDF"
          :disabled="isGenerating"
          class="w-full rounded bg-gradient-to-r from-purple-600 to-pink-600 px-4 py-3 font-medium text-white shadow-lg transition hover:from-purple-700 hover:to-pink-700 disabled:opacity-50"
        >
          <span v-if="!isGenerating">ğŸ“„ ç”Ÿæˆ PDF</span>
          <span v-else>â³ ç”Ÿæˆä¸­...</span>
        </button>
      </div>
    </div>

    <script>
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            // åŸºç¡€ä¿¡æ¯
            projectName: "æŸæŸé¡¹ç›®",
            quoteDate: "2025 å¹´ 6 æœˆ 6 æ—¥",
            validUntil: "2025 å¹´ 7 æœˆ 6 æ—¥",
            clientName: "æŸæŸå…¬å¸",
            designerName: "@æŸæŸè®¾è®¡å¸ˆ",
            qrCodeImage: "",

            // è¡¨æ ¼è¡Œæ•°æ®
            tableRows: [
              {
                workItem: "ä¸€çº§é¡µé¢",
                amount: 1400,
                originalPrice: 2000,
                unit: "å…ƒ/é¡¹",
                remarks: "é¦–é¡µ",
                tips: "æ•´ä½“å·¥æ—¶å®‰æ’ï¼š<br />â‘  3 å¤©è®¾è®¡ UI è§†è§‰æ–¹æ¡ˆ PPT ç¡®å®šé¡µé¢é£æ ¼ï¼›<br />â‘¡ ç¡®å®šé£æ ¼å 5 å¤©å†…è®¾è®¡å®Œæˆå¹¶ä¸”åˆ‡å›¾äº¤ä»˜ï¼›",
              },
              {
                workItem: "äºŒçº§é¡µé¢",
                amount: 1470,
                originalPrice: 2100,
                unit: "å…ƒ/é¡¹",
                remarks: "è¯¦æƒ…é¡µã€ä¸ªäººé¡µ",
                tips: "",
              },
              {
                workItem: "æ¬¡çº§é¡µé¢",
                amount: 1000,
                originalPrice: 1250,
                unit: "å…ƒ/é¡¹",
                remarks: "æ¬¢è¿é¡µã€å¼•å¯¼é¡µ 4Pã€",
                tips: "",
              },
            ],

            // æ–°è¡Œè¾“å…¥
            newRow: {
              workItem: "",
              amount: 0,
              originalPrice: 0,
              unit: "å…ƒ/é¡¹",
              remarks: "",
              tips: "",
            },

            // æ±‡æ€»ä¿¡æ¯
            discountRate: 91,
            summaryNote: "æ–°å®¢ä¼˜æƒ ï¼ˆæŠ¥ä»·é‡‘é¢ 91 æŠ˜ï¼‰",

            // PDFç”ŸæˆçŠ¶æ€
            isGenerating: false,

            // æ‹–æ‹½ç›¸å…³
            isDragging: false,
            dragStartX: 0,
            dragStartY: 0,
            pageX: 0,
            pageY: 0,

            // ç¼©æ”¾ç›¸å…³
            scale: 0.7,
            minScale: 0.3,
            maxScale: 3,
          };
        },
        computed: {
          totalAmount() {
            return this.tableRows.reduce(
              (sum, row) => sum + Number(row.amount || 0),
              0
            );
          },
          totalOriginalPrice() {
            return this.tableRows.reduce(
              (sum, row) => sum + Number(row.originalPrice || 0),
              0
            );
          },
          discountedTotal() {
            return Math.round(this.totalAmount * (this.discountRate / 100));
          },
        },
        methods: {
          addRow() {
            if (!this.newRow.workItem || !this.newRow.amount) {
              alert("è¯·è‡³å°‘å¡«å†™å·¥ä½œé¡¹å’Œé‡‘é¢");
              return;
            }

            this.tableRows.push({
              workItem: this.newRow.workItem,
              amount: Number(this.newRow.amount),
              originalPrice: Number(this.newRow.originalPrice),
              unit: this.newRow.unit,
              remarks: this.newRow.remarks,
              tips: this.newRow.tips,
            });

            // é‡ç½®è¡¨å•
            this.newRow = {
              workItem: "",
              amount: 0,
              originalPrice: 0,
              unit: "å…ƒ/é¡¹",
              remarks: "",
              tips: "",
            };
          },
          removeRow(index) {
            if (confirm("ç¡®å®šåˆ é™¤è¿™ä¸ªå·¥ä½œé¡¹å—ï¼Ÿ")) {
              this.tableRows.splice(index, 1);
            }
          },
          handleQRCodeUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // éªŒè¯æ–‡ä»¶ç±»å‹
            if (!file.type.startsWith("image/")) {
              alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶");
              return;
            }

            // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ä¸º5MBï¼‰
            if (file.size > 5 * 1024 * 1024) {
              alert("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB");
              return;
            }

            // è¯»å–æ–‡ä»¶å¹¶è½¬æ¢ä¸ºbase64
            const reader = new FileReader();
            reader.onload = (e) => {
              this.qrCodeImage = e.target.result;
            };
            reader.onerror = () => {
              alert("å›¾ç‰‡è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•");
            };
            reader.readAsDataURL(file);
          },
          removeQRCode() {
            if (confirm("ç¡®å®šåˆ é™¤äºŒç»´ç å›¾ç‰‡å—ï¼Ÿ")) {
              this.qrCodeImage = "";
              // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
              const fileInput = document.querySelector('input[type="file"]');
              if (fileInput) {
                fileInput.value = "";
              }
            }
          },
          async generatePDF() {
            this.isGenerating = true;

            try {
              const element = document.getElementById("pdf-content");
              const container = element.parentElement;

              // åˆ›å»ºä¸´æ—¶çš„å¯¼å‡ºå®¹å™¨
              const exportWrapper = document.createElement("div");
              exportWrapper.style.cssText = `
                position: fixed;
                left: -9999px;
                top: 0;
                width: 210mm;
                background: white;
                z-index: 9999;
              `;
              document.body.appendChild(exportWrapper);

              // ä¿å­˜åŸå§‹çˆ¶å…ƒç´ å’Œæ ·å¼
              const originalParent = element.parentElement;
              const originalStyles = {
                transform: element.style.transform,
                position: element.style.position,
                left: element.style.left,
                top: element.style.top,
                cursor: element.style.cursor,
                userSelect: element.style.userSelect,
                margin: element.style.margin,
              };

              // å°†å…ƒç´ ç§»åŠ¨åˆ°å¯¼å‡ºå®¹å™¨å¹¶é‡ç½®æ ·å¼
              exportWrapper.appendChild(element);
              element.style.transform = "none";
              element.style.position = "relative";
              element.style.left = "auto";
              element.style.top = "auto";
              element.style.cursor = "default";
              element.style.userSelect = "auto";
              element.style.margin = "0";

              // ç­‰å¾…DOMæ›´æ–°
              await new Promise((resolve) => setTimeout(resolve, 100));

              const opt = {
                margin: [10, 10, 10, 10],
                filename: `${this.projectName}-æŠ¥ä»·æ–¹æ¡ˆ.pdf`,
                image: { type: "jpeg", quality: 0.98 },
                html2canvas: {
                  scale: 2,
                  useCORS: true,
                  logging: false,
                  letterRendering: true,
                  backgroundColor: "#ffffff",
                },
                jsPDF: {
                  unit: "mm",
                  format: "a4",
                  orientation: "portrait",
                  compress: true,
                },
                pagebreak: { mode: "avoid-all" },
              };

              await html2pdf().set(opt).from(element).save();

              // å°†å…ƒç´ ç§»å›åŸä½ç½®å¹¶æ¢å¤æ ·å¼
              originalParent.appendChild(element);
              Object.assign(element.style, originalStyles);

              // åˆ é™¤ä¸´æ—¶å®¹å™¨
              document.body.removeChild(exportWrapper);
            } catch (error) {
              console.error("PDFç”Ÿæˆå¤±è´¥:", error);
              alert("PDFç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•");

              // ç¡®ä¿æ¸…ç†
              const exportWrapper = document.querySelector(
                'div[style*="left: -9999px"]'
              );
              if (exportWrapper) {
                const element = document.getElementById("pdf-content");
                const container = document.querySelector(".preview-container");
                if (element && container) {
                  container.appendChild(element);
                }
                document.body.removeChild(exportWrapper);
              }
            } finally {
              this.isGenerating = false;
            }
          },
          // æ‹–æ‹½ç›¸å…³æ–¹æ³•
          startDrag(event) {
            this.isDragging = true;
            this.dragStartX = event.clientX - this.pageX;
            this.dragStartY = event.clientY - this.pageY;

            document.addEventListener("mousemove", this.onDrag);
            document.addEventListener("mouseup", this.stopDrag);

            event.preventDefault();
          },
          onDrag(event) {
            if (!this.isDragging) return;

            this.pageX = event.clientX - this.dragStartX;
            this.pageY = event.clientY - this.dragStartY;
          },
          stopDrag() {
            this.isDragging = false;
            document.removeEventListener("mousemove", this.onDrag);
            document.removeEventListener("mouseup", this.stopDrag);
          },
          // æ»šè½®ç¼©æ”¾
          handleWheel(event) {
            event.preventDefault();

            const delta = event.deltaY > 0 ? -0.1 : 0.1;
            const newScale = Math.min(
              this.maxScale,
              Math.max(this.minScale, this.scale + delta)
            );

            // è®¡ç®—é¼ æ ‡ä½ç½®ç›¸å¯¹äºçº¸å¼ çš„åæ ‡
            const rect = event.currentTarget
              .querySelector(".page")
              .getBoundingClientRect();
            const mouseX = event.clientX - rect.left;
            const mouseY = event.clientY - rect.top;

            // æ ¹æ®é¼ æ ‡ä½ç½®è°ƒæ•´çº¸å¼ ä½ç½®ï¼Œå®ç°ä»¥é¼ æ ‡ä¸ºä¸­å¿ƒç¼©æ”¾
            const scaleChange = newScale / this.scale;
            this.pageX =
              event.clientX -
              mouseX * scaleChange -
              (event.clientX - rect.left - mouseX);
            this.pageY =
              event.clientY -
              mouseY * scaleChange -
              (event.clientY - rect.top - mouseY);

            this.scale = newScale;
          },
        },
        mounted() {
          // é¡µé¢åŠ è½½åè‡ªåŠ¨å±…ä¸­çº¸å¼ 
          this.$nextTick(() => {
            const container = document.querySelector(".preview-container");
            const page = document.getElementById("pdf-content");

            if (container && page) {
              const containerRect = container.getBoundingClientRect();
              const pageWidth = 210 * 3.7795275591; // 210mmè½¬æ¢ä¸ºpx
              const pageHeight = page.offsetHeight;

              // è®¡ç®—å±…ä¸­ä½ç½®
              this.pageX = (containerRect.width - pageWidth * this.scale) / 2;
              this.pageY = 50; // é¡¶éƒ¨ç•™ä¸€äº›è¾¹è·
            }
          });
        },
      }).mount("#app");
    </script>
  </body>
</html>
